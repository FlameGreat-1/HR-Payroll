{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}{{ block.super }}
<script src="{% static 'admin/js/core.js' %}"></script>
{{ media }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

{% block extrajs %}{{ block.super }}
<script src="{% static 'admin/js/admin/RelatedObjectLookups.js' %}"></script>
<script src="{% static 'admin/js/actions.js' %}"></script>
<script src="{% static 'admin/js/urlify.js' %}"></script>
<script src="{% static 'admin/js/prepopulate.js' %}"></script>
<script src="{% static 'admin/js/vendor/xregexp/xregexp.js' %}"></script>
{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% if not is_popup %}
{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {% if add %}{% blocktrans with name=opts.verbose_name %}Add {{ name }}{% endblocktrans %}{% else %}{{ original|truncatewords:"18" }}{% endif %}
</div>
{% endblock %}
{% endif %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-card">
        <div id="content-main">
            {% block object-tools %}
            {% if change %}{% if not is_popup %}
              <ul class="object-tools">
                {% block object-tools-items %}
                  <li>
                      <a href="{% url opts|admin_urlname:'history' original.pk|admin_urlquote %}" class="historylink">{% trans "History" %}</a>
                  </li>
                  {% if has_absolute_url %}
                      <li><a href="{{ absolute_url }}" class="viewsitelink">{% trans "View on site" %}</a></li>
                  {% endif %}
                  {% if original.status == 'ACTIVE' and original.end_date and original.days_remaining <= 90 %}
                  <li>
                      <a href="{% url 'admin:employees_contract_renew' original.pk %}" class="renewlink">Renew Contract</a>
                  </li>
                  {% endif %}
                  {% if original.contract_file %}
                  <li>
                      <a href="{{ original.contract_file.url }}" target="_blank" class="downloadlink">Download Contract</a>
                  </li>
                  {% endif %}
                  {% if original.status == 'ACTIVE' %}
                  <li>
                      <a href="{% url 'admin:employees_contract_terminate' original.pk %}" class="terminatelink">Terminate Contract</a>
                  </li>
                  {% endif %}
                {% endblock %}
              </ul>
            {% endif %}{% endif %}
            {% endblock %}

            {% if not add %}
            <div class="contract-header">
                <div class="contract-info">
                    <div class="contract-icon">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <div class="contract-details">
                        <h2 class="contract-title">Contract {{ original.contract_number }}</h2>
                        <div class="contract-meta">
                            <span class="employee-name">{{ original.employee.get_full_name }}</span>
                            <span class="separator">•</span>
                            <span class="contract-type">{{ original.get_contract_type_display }}</span>
                            <span class="separator">•</span>
                            {% if original.status == 'ACTIVE' %}
                                <span class="status-active">{{ original.get_status_display }}</span>
                            {% elif original.status == 'EXPIRED' %}
                                <span class="status-inactive">{{ original.get_status_display }}</span>
                            {% else %}
                                <span class="status-suspended">{{ original.get_status_display }}</span>
                            {% endif %}
                        </div>
                        <div class="contract-timeline">
                            <span class="timeline-info">{{ original.start_date|date:"M d, Y" }} - {% if original.end_date %}{{ original.end_date|date:"M d, Y" }}{% else %}Permanent{% endif %}</span>
                            {% if original.end_date %}
                                <span class="separator">•</span>
                                {% with days_left=original.days_remaining %}
                                    {% if days_left <= 0 %}
                                        <span class="contract-expired">Expired</span>
                                    {% elif days_left <= 30 %}
                                        <span class="contract-expiring-soon">{{ days_left }} days remaining</span>
                                    {% else %}
                                        <span class="contract-active">{{ days_left }} days remaining</span>
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <form {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="{{ form_url }}" method="post" id="{{ opts.model_name }}_form" novalidate>{% csrf_token %}{% block form_top %}{% endblock %}
            <div>
            {% if is_popup %}<input type="hidden" name="{{ is_popup_var }}" value="1">{% endif %}
            {% if to_field %}<input type="hidden" name="{{ to_field_var }}" value="{{ to_field }}">{% endif %}
            {% if save_on_top %}{% block submit_buttons_top %}{% submit_row %}{% endblock %}{% endif %}
            {% if errors %}
                <p class="errornote">
                {% if errors|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}
                </p>
                {{ adminform.form.non_field_errors }}
            {% endif %}

            <div class="form-sections">
                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-user"></i> Employee Information</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field">
                                <label for="id_employee">Employee:</label>
                                {{ adminform.form.employee }}
                                {% if adminform.form.employee.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.employee.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                <div class="field-help">Select the employee for this contract</div>
                            </div>
                            <div class="form-field">
                                <label for="id_contract_number">Contract Number:</label>
                                {{ adminform.form.contract_number }}
                                {% if adminform.form.contract_number.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.contract_number.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                <div class="field-help">Auto-generated if left blank</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-file-contract"></i> Contract Details</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field">
                                <label for="id_contract_type">Contract Type:</label>
                                {{ adminform.form.contract_type }}
                                {% if adminform.form.contract_type.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.contract_type.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="form-field">
                                <label for="id_status">Status:</label>
                                {{ adminform.form.status }}
                                {% if adminform.form.status.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.status.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="form-field">
                                <label for="id_signed_date">Signed Date:</label>
                                {{ adminform.form.signed_date }}
                                {% if adminform.form.signed_date.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.signed_date.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-calendar"></i> Contract Timeline</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field">
                                <label for="id_start_date">Start Date:</label>
                                {{ adminform.form.start_date }}
                                {% if adminform.form.start_date.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.start_date.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="form-field">
                                <label for="id_end_date">End Date:</label>
                                {{ adminform.form.end_date }}
                                {% if adminform.form.end_date.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.end_date.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                <div class="field-help">Leave blank for permanent contract</div>
                            </div>
                        </div>
                        {% if not add %}
                        <div class="timeline-display">
                            <div class="timeline-item">
                                <span class="timeline-label">Duration:</span>
                                <span class="timeline-value">
                                    {% if original.end_date %}
                                        {{ original.start_date|timesince:original.end_date }}
                                    {% else %}
                                        Permanent
                                    {% endif %}
                                </span>
                            </div>
                            {% if original.end_date %}
                            <div class="timeline-item">
                                <span class="timeline-label">Days Remaining:</span>
                                <span class="timeline-value">{{ original.days_remaining }} days</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-briefcase"></i> Job Details</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field">
                                <label for="id_job_title">Job Title:</label>
                                {{ adminform.form.job_title }}
                                {% if adminform.form.job_title.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.job_title.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="form-field">
                                <label for="id_department">Department:</label>
                                {{ adminform.form.department }}
                                {% if adminform.form.department.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.department.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="form-field">
                                <label for="id_reporting_manager">Reporting Manager:</label>
                                {{ adminform.form.reporting_manager }}
                                {% if adminform.form.reporting_manager.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.reporting_manager.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-dollar-sign"></i> Compensation & Benefits</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field">
                                <label for="id_basic_salary">Basic Salary:</label>
                                <div class="salary-input">
                                    <span class="currency-symbol">$</span>
                                    {{ adminform.form.basic_salary }}
                                </div>
                                {% if adminform.form.basic_salary.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.basic_salary.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="form-field">
                                <label for="id_benefits">Benefits:</label>
                                {{ adminform.form.benefits }}
                                {% if adminform.form.benefits.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.benefits.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                <div class="field-help">Health insurance, retirement plans, etc.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-clock"></i> Work Schedule & Terms</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field">
                                <label for="id_working_hours">Working Hours:</label>
                                {{ adminform.form.working_hours }}
                                {% if adminform.form.working_hours.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.working_hours.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                <div class="field-help">e.g., 40 hours per week</div>
                            </div>
                            <div class="form-field">
                                <label for="id_probation_period">Probation Period (months):</label>
                                {{ adminform.form.probation_period }}
                                {% if adminform.form.probation_period.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.probation_period.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                            <div class="form-field">
                                <label for="id_notice_period">Notice Period (days):</label>
                                {{ adminform.form.notice_period }}
                                {% if adminform.form.notice_period.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.notice_period.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-file-alt"></i> Terms & Conditions</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field full-width">
                                <label for="id_terms_and_conditions">Terms & Conditions:</label>
                                {{ adminform.form.terms_and_conditions }}
                                {% if adminform.form.terms_and_conditions.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.terms_and_conditions.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                <div class="field-help">Detailed terms and conditions of employment</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-file-upload"></i> Contract Documentation</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field">
                                <label for="id_contract_file">Contract File:</label>
                                {{ adminform.form.contract_file }}
                                {% if adminform.form.contract_file.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.contract_file.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                                <div class="field-help">Upload signed contract (PDF format recommended)</div>
                                {% if original.contract_file %}
                                    <div class="current-file">
                                        <i class="fas fa-file-pdf"></i>
                                        <a href="{{ original.contract_file.url }}" target="_blank">{{ original.contract_file.name }}</a>
                                        <span class="file-size">({{ original.contract_file.size|filesizeformat }})</span>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cog"></i> System Information</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row-grid">
                            <div class="form-field">
                                <label for="id_is_active">Active Status:</label>
                                {{ adminform.form.is_active }}
                                {% if adminform.form.is_active.errors %}
                                    <ul class="errorlist">
                                        {% for error in adminform.form.is_active.errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                        {% if not add %}
                        <div class="system-info">
                            <div class="info-row">
                                <span class="info-label">Created:</span>
                                <span class="info-value">{{ original.created_at|date:"M d, Y H:i" }}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Last Updated:</span>
                                <span class="info-value">{{ original.updated_at|date:"M d, Y H:i" }}</span>
                            </div>
                            {% if original.end_date %}
                            <div class="info-row">
                                <span class="info-label">Contract Duration:</span>
                                <span class="info-value">{{ original.start_date|timesince:original.end_date }}</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% block submit_buttons_bottom %}{% submit_row %}{% endblock %}

            {% block admin_change_form_document_ready %}
                <script id="django-admin-form-add-constants"
                        src="{% static 'admin/js/change_form.js' %}"
                        {% if adminform and add %}
                            data-model-name="{{ opts.model_name }}"
                        {% endif %}
                        async>
                </script>
            {% endblock %}

            {% prepopulated_fields_js %}

            </div>
            </form>
        </div>
    </div>
</div>
<style>
    .contract-header {
        background: linear-gradient(90deg, #3D5AFE 0%, #D500F9 100%);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 30px;
        box-shadow: 0 6px 20px rgba(213, 0, 249, 0.3);
    }
    
    .contract-info {
        display: flex;
        align-items: center;
        gap: 20px;
    }
    
    .contract-icon i {
        font-size: 64px;
        color: #FFFFFF;
    }
    
    .contract-title {
        color: #FFFFFF;
        font-size: 28px;
        font-weight: 700;
        margin: 0 0 8px 0;
        font-family: 'Inter', 'Roboto', sans-serif;
    }
    
    .contract-meta {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
    }
    
    .employee-name {
        color: #F1F1F1;
        font-weight: 600;
        font-size: 14px;
    }
    
    .contract-type {
        color: #F1F1F1;
        font-weight: 600;
        font-size: 14px;
    }
    
    .separator {
        color: #E0E0E0;
        font-weight: 300;
    }
    
    .contract-timeline {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .timeline-info {
        color: #F1F1F1;
        font-size: 13px;
        font-weight: 500;
    }
    
    .contract-expired {
        color: #EF4444;
        font-weight: 600;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .contract-expiring-soon {
        color: #F59E0B;
        font-weight: 600;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
        animation: pulse 2s infinite;
    }
    
    .contract-active {
        color: #10B981;
        font-weight: 600;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .form-sections {
        display: flex;
        flex-direction: column;
        gap: 30px;
    }
    
    .form-section {
        background: #FFFFFF;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(213, 0, 249, 0.1);
        overflow: hidden;
    }
    
    .section-header {
        background: linear-gradient(90deg, #3D5AFE 0%, #D500F9 100%);
        padding: 16px 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .section-header h3 {
        color: #FFFFFF;
        font-size: 16px;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .section-content {
        padding: 24px;
    }
    
    .form-row-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .form-row-grid:last-child {
        margin-bottom: 0;
    }
    
    .form-field {
        display: flex;
        flex-direction: column;
    }
    
    .form-field.full-width {
        grid-column: 1 / -1;
    }
    
    .form-field label {
        font-family: 'Inter', 'Roboto', sans-serif;
        font-weight: 600;
        color: #2B2B2B;
        font-size: 14px;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .form-field input, .form-field select, .form-field textarea {
        width: 100%;
        border: 2px solid #E5E7EB;
        border-radius: 8px;
        padding: 14px 16px;
        font-family: 'Inter', 'Roboto', sans-serif;
        font-weight: 500;
        font-size: 15px;
        background: #FFFFFF;
        color: #2B2B2B;
        transition: all 0.3s ease;
        box-sizing: border-box;
    }
    
    .form-field input:focus, .form-field select:focus, .form-field textarea:focus {
        border-color: #3D5AFE;
        outline: none;
        box-shadow: 0 0 0 3px rgba(61, 90, 254, 0.1);
        background: #FAFBFC;
    }
    
    .form-field textarea {
        min-height: 120px;
        resize: vertical;
    }
    
    .salary-input {
        position: relative;
        display: flex;
        align-items: center;
    }
    
    .currency-symbol {
        position: absolute;
        left: 16px;
        color: #6B7280;
        font-weight: 600;
        z-index: 1;
    }
    
    .salary-input input {
        padding-left: 40px;
    }
    
    .field-help {
        font-size: 12px;
        color: #6B7280;
        margin-top: 4px;
        font-style: italic;
    }
    
    .timeline-display {
        margin-top: 20px;
        padding: 16px;
        background: #F8F9FA;
        border-radius: 8px;
        border: 1px solid #E5E7EB;
    }
    
    .timeline-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 0;
    }
    
    .timeline-label {
        font-weight: 600;
        color: #374151;
        font-size: 13px;
    }
    
    .timeline-value {
        color: #6B7280;
        font-size: 13px;
        font-weight: 500;
    }
    
    .current-file {
        margin-top: 8px;
        padding: 8px 12px;
        background: #F3F4F6;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
    }
    
    .current-file i {
        color: #EF4444;
    }
    
    .current-file a {
        color: #3D5AFE;
        text-decoration: none;
        font-weight: 500;
    }
    
    .current-file a:hover {
        text-decoration: underline;
    }
    
    .file-size {
        color: #6B7280;
        font-size: 11px;
    }
    
    .system-info {
        margin-top: 20px;
        padding: 16px;
        background: #F8F9FA;
        border-radius: 8px;
        border: 1px solid #E5E7EB;
    }
    
    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 0;
    }
    
    .info-label {
        font-weight: 600;
        color: #374151;
        font-size: 13px;
    }
    
    .info-value {
        color: #6B7280;
        font-size: 13px;
    }
    
    .status-active {
        background: linear-gradient(90deg, #10B981 0%, #059669 100%);
        color: #FFFFFF;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
    }
    
    .status-inactive {
        background: linear-gradient(90deg, #EF4444 0%, #DC2626 100%);
        color: #FFFFFF;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
    }
    
    .status-suspended {
        background: linear-gradient(90deg, #F59E0B 0%, #D97706 100%);
        color: #FFFFFF;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
    }
    
    .renewlink {
        background: linear-gradient(90deg, #10B981 0%, #059669 100%) !important;
        color: #FFFFFF !important;
    }
    
    .renewlink:hover {
        background: linear-gradient(90deg, #059669 0%, #047857 100%) !important;
        color: #FFFFFF !important;
    }
    
    .downloadlink {
        background: linear-gradient(90deg, #8B5CF6 0%, #7C3AED 100%) !important;
        color: #FFFFFF !important;
    }
    
    .downloadlink:hover {
        background: linear-gradient(90deg, #7C3AED 0%, #6D28D9 100%) !important;
        color: #FFFFFF !important;
    }
    
    .terminatelink {
        background: linear-gradient(90deg, #EF4444 0%, #DC2626 100%) !important;
        color: #FFFFFF !important;
    }
    
    .terminatelink:hover {
        background: linear-gradient(90deg, #DC2626 0%, #B91C1C 100%) !important;
        color: #FFFFFF !important;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    
    @media (max-width: 768px) {
        .contract-info {
            flex-direction: column;
            text-align: center;
            gap: 16px;
        }
        
        .contract-title {
            font-size: 24px;
        }
        
        .contract-meta {
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .form-row-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }
        
        .section-content {
            padding: 16px;
        }
    }
    
    @media (max-width: 480px) {
        .contract-header {
            padding: 16px;
        }
        
        .contract-icon i {
            font-size: 48px;
        }
        
        .contract-title {
            font-size: 20px;
        }
        
        .section-header {
            padding: 12px 16px;
        }
        
        .section-content {
            padding: 12px;
        }
    }
    </style>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const startDateField = document.getElementById('id_start_date');
        const endDateField = document.getElementById('id_end_date');
        const contractTypeField = document.getElementById('id_contract_type');
        const statusField = document.getElementById('id_status');
        
        function validateDates() {
            if (startDateField && endDateField) {
                const startDate = new Date(startDateField.value);
                const endDate = new Date(endDateField.value);
                
                if (startDate && endDate && endDate <= startDate) {
                    endDateField.setCustomValidity('End date must be after start date');
                } else {
                    endDateField.setCustomValidity('');
                }
            }
        }
        
        function toggleEndDateRequirement() {
            if (contractTypeField && endDateField) {
                const isPermanent = contractTypeField.value === 'PERMANENT';
                const endDateRow = endDateField.closest('.form-field');
                
                if (endDateRow) {
                    if (isPermanent) {
                        endDateField.removeAttribute('required');
                        endDateRow.style.opacity = '0.6';
                    } else {
                        endDateField.setAttribute('required', 'required');
                        endDateRow.style.opacity = '1';
                    }
                }
            }
        }
        
        if (startDateField && endDateField) {
            startDateField.addEventListener('change', validateDates);
            endDateField.addEventListener('change', validateDates);
        }
        
        if (contractTypeField) {
            contractTypeField.addEventListener('change', toggleEndDateRequirement);
            toggleEndDateRequirement();
        }
        
        const salaryInput = document.getElementById('id_basic_salary');
        if (salaryInput) {
            salaryInput.addEventListener('input', function() {
                let value = this.value.replace(/[^\d.]/g, '');
                if (value.split('.').length > 2) {
                    value = value.substring(0, value.lastIndexOf('.'));
                }
                this.value = value;
            });
        }
        
        const contractFileField = document.getElementById('id_contract_file');
        if (contractFileField) {
            contractFileField.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const maxSize = 10 * 1024 * 1024;
                    const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                    
                    if (file.size > maxSize) {
                        alert('File size must be less than 10MB');
                        this.value = '';
                        return;
                    }
                    
                    if (!allowedTypes.includes(file.type)) {
                        alert('Only PDF, DOC, DOCX, JPG, and PNG files are allowed');
                        this.value = '';
                        return;
                    }
                }
            });
        }
        
        const probationPeriodField = document.getElementById('id_probation_period');
        const noticePeriodField = document.getElementById('id_notice_period');
        
        if (probationPeriodField) {
            probationPeriodField.addEventListener('input', function() {
                const value = parseInt(this.value);
                if (value && (value < 0 || value > 24)) {
                    this.setCustomValidity('Probation period must be between 0 and 24 months');
                } else {
                    this.setCustomValidity('');
                }
            });
        }
        
        if (noticePeriodField) {
            noticePeriodField.addEventListener('input', function() {
                const value = parseInt(this.value);
                if (value && (value < 0 || value > 365)) {
                    this.setCustomValidity('Notice period must be between 0 and 365 days');
                } else {
                    this.setCustomValidity('');
                }
            });
        }
        
        const form = document.getElementById('contract_form');
        if (form) {
            form.addEventListener('submit', function(e) {
                const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
                let hasErrors = false;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.style.borderColor = '#EF4444';
                        hasErrors = true;
                    } else {
                        field.style.borderColor = '#E5E7EB';
                    }
                });
                
                if (hasErrors) {
                    e.preventDefault();
                    alert('Please fill in all required fields.');
                    return;
                }
                
                const startDate = new Date(startDateField.value);
                const endDate = new Date(endDateField.value);
                
                if (startDate && endDate && endDate <= startDate) {
                    e.preventDefault();
                    alert('End date must be after start date.');
                    return;
                }
            });
        }
        
        const employeeField = document.getElementById('id_employee');
        if (employeeField) {
            employeeField.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                if (selectedOption && selectedOption.value) {
                    fetch(`/admin/employees/contract/check-overlap/?employee=${selectedOption.value}&start_date=${startDateField.value}&end_date=${endDateField.value}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.has_overlap) {
                            alert('Warning: This employee has overlapping contracts during the selected period.');
                        }
                    })
                    .catch(error => {
                        console.error('Error checking contract overlap:', error);
                    });
                }
            });
        }
        
        if (statusField && statusField.value === 'ACTIVE') {
            const today = new Date();
            const startDate = new Date(startDateField.value);
            const endDate = endDateField.value ? new Date(endDateField.value) : null;
            
            if (endDate && endDate <= today) {
                const warningDiv = document.createElement('div');
                warningDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> This contract has expired and should be updated.';
                warningDiv.style.cssText = 'background: linear-gradient(90deg, #F59E0B 0%, #D97706 100%); color: white; padding: 12px 16px; border-radius: 8px; margin: 10px 0; font-weight: 600;';
                form.insertBefore(warningDiv, form.firstChild);
            }
        }
    });
    </script>
    {% endblock %}
    

